<html>
<head>
  <title>05. OGNL -对象图导航语言。</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/302292 (zh-CN); Windows/10.0.10586 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="360"/>
<h1>05. OGNL -对象图导航语言。</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
一、什么是 OGNL
<div>     OGNL（Object-Graph Navigation Language，对象图导航语言），它是一个功能强大的表达式语言，用来获取和设置Java对象的属性以及调用对象的方法。它旨在提供一个更高的更抽象的层次来对Java对象图进行导航。</div><div>     OGNL是Struts2的默认表达语言，OGNL表达式的计算是围绕OGNL上下文（Context）进行的，相当于一个Map对象，见下图的结构：</div><div><img src="05. OGNL -对象图导航语言。_files/Image.png" type="image/png" height="206" style="cursor: default;" width="596"/></div><div>二、OGNL中重要的3个符号：#、%、$</div><div>     1.# 符号</div><div>     通常有三种用法：</div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>访问非root对象。</div></blockquote><div>          用于过滤和投影集合。</div><div>          构造Map，例如：#{'key1':'value1', 'key2':'value2'}。</div><div>     2.% 符号</div><div>     用途是告诉标签的处理类将它包含的字符串，强行按照OGNL表达式处理。</div><div>例如：</div><div>     &lt;s:set name=&quot;mySet&quot; value=&quot;#{'key1':'value1','key2':'value2'}&quot; /&gt;</div><div>     &lt;s:property value=&quot;#mySet['key1']&quot;/&gt;   //输出的是value1</div><div>     </div><div>     &lt;s:url value=&quot;#mySet['key1']&quot; /&gt;      //如果输出的是#mySet['key1']</div><div>     &lt;s:url value=&quot;%{#mySet['key1']}&quot;/&gt;   //强行OGNL格式输出，是value1</div><div>    3.$ 符号</div><div>          通常在struts.xml配置文件中的使用方式如下： </div><div>     &lt;field-validator type=&quot;stringlength&quot;&gt;  </div><div>            &lt;param name=&quot;maxLength&quot;&gt;18&lt;/param&gt;  </div><div>               &lt;param name=&quot;minLength&quot;&gt;6&lt;/param&gt;  </div><div>               &lt;param name=&quot;trim&quot;&gt;true&lt;/param&gt;  </div><div>            &lt;message&gt;密码强度必须在 ${minLength}到${maxLength} 之间！&lt;/message&gt;  </div><div>        &lt;/field-validator&gt;</div><div>三、访问普通方法、属性、构造方法</div><div>     &lt;!-- 1. 访问Value Stack中action的普通属性 --&gt;</div><div>     &lt;s:property value=&quot;name&quot;/&gt;</div><div><br/></div><div>     &lt;!-- 2. 访问Value Stack中对象的普通属性(要有get set方法) --&gt;</div><div>     &lt;!-- 第一种方式 --&gt;</div><div>     &lt;s:property value=&quot;user.age&quot;/&gt; </div><div><br/></div><div>     &lt;!-- 第二种方式 ，有引号--&gt;</div><div>     &lt;s:property value=&quot;user['age']&quot;/&gt;</div><div>     </div><div>     &lt;!-- 错误方法 --&gt;</div><div>     &lt;!-- &lt;s:property value=&quot;user[age]&quot;/&gt; --&gt;</div><div><br/></div><div>     &lt;!-- 3.调用Value Stack中对象的普通方法 --&gt;</div><div>&lt;s:property value=&quot;user.setName('master')&quot; /&gt;结果显示: &lt;s:property value=&quot;user.name&quot; /&gt;                //输出结果为 “结果显示：master”</div><div><br/></div><div>     &lt;!-- 4.调用Value Stack中action属性的方法 --&gt;</div><div>     &lt;s:property value=&quot;name.length()&quot;/&gt;</div><div><br/></div><div>     &lt;!-- 5.调用Value Stack中action的普通方法 --&gt;</div><div>     &lt;s:property value=&quot;add()&quot; /&gt;</div><div><br/></div><div>     &lt;!-- 6.调用普通类的构造方法 --&gt;</div><div>     &lt;s:property value=&quot;new user.User()&quot;/&gt; //实例化一个对象</div><div>四、访问静态方法</div><div>注意：在访问静态方法、静态变量之前，要先在struts2.xml中配置 &lt;constant name=&quot;struts.ognl.allowStaticMethodAccess&quot; value=&quot;true&quot;/&gt; ，设置静态方法调用为true，否则访问不到数据。</div><div>     1.访问静态属性</div><div>          /* 访问静态属性表达式的格式为：@[类全名（包括包路径）]@[值名] */</div><div>          &lt;s:property value=&quot;@action.UserAction@index&quot;/&gt;</div><div>     2.调用静态方法</div><div>          /* 调用静态方法表达式的格式为：@[类全名（包括包路径）]@[方法名] */</div><div>          &lt;s:property value=&quot;@action.UserAction@getInstance()&quot;/&gt;</div><div>     3.调用 Math 类的静态方法</div><div>          &lt;s:property value=&quot;@@max(2, 3)&quot; /&gt;</div><div>五、访问集合对象</div><div>     集合对象比如List，Set，Map等。List和数组的访问形式类似，这里以List为例。假设有一个List名为 userlist。</div><div>（1）List</div><div>     访问List</div><div>     &lt;s:property value=&quot;userlist&quot;/&gt;</div><div>     访问List对象中某个元素</div><div>     &lt;s:property value=&quot;userlist[1]&quot;/&gt;</div><div>     访问List中元素某个属性的集合</div><div>     &lt;s:property value=&quot;userlist.{age}&quot;/&gt;</div><div>     访问List中元素某个属性的集合中的特定值</div><div>     &lt;!-- 第一种方法( 不常用 ) --&gt;</div><div>     &lt;s:property value=&quot;userlist.{age}[0]&quot;/&gt;</div><div>     &lt;!-- 第二种方法 --&gt;</div><div>     &lt;s:property value=&quot;userlist[0].age&quot;/&gt;</div><div>（2）Set</div><div><br/></div><div>     访问Set对象</div><div>     &lt;s:property value=&quot;userSet&quot;/&gt;</div><div>     Set集合的访问方式与List集合类似，这里不再重复演示，但要注意的是，Set是无序的集合，所以不能获取某个特定的元素值：</div><div>     &lt;!-- 错误方法，set集合没有序号 --&gt;</div><div>     &lt;s:property value=&quot;userSet[0]&quot;/&gt;</div><div>（3）Map</div><div>     访问Map对象</div><div>     &lt;s:property value=&quot;userMap&quot;/&gt;</div><div>     访问Map中某个元素</div><div>     &lt;!-- 第一种方式 --&gt;</div><div>     &lt;s:property value=&quot;userMap.user1&quot;/&gt; </div><div>     &lt;!-- 第二种方式 --&gt;</div><div>     &lt;s:property value=&quot;userMap['user1']&quot;/&gt; |  &lt;s:property value=&quot;userMap[\&quot;user1\&quot;]&quot;/&gt;</div><div>     访问Map中所有的keys</div><div>     &lt;s:property value=&quot;userMap.keys&quot;/&gt;</div><div>     访问Map中所有的values</div><div>     &lt;s:property value=&quot;userMap.values&quot;/&gt;</div><div>     访问Map的大小</div><div>     &lt;s:property value=&quot;userMap.size()&quot;/&gt; | &lt;s:property value=&quot;userMap.size&quot;/&gt;     </div><div>六、投影与过滤</div><div>注意细节，不同的符号代表不同含义：（一种类正则表达法）</div><div>     ? - 满足条件的所有元素</div><div>     ^ - 满足条件的第一个元素</div><div>     $ - 满足条件的最后一个元素</div><div>     1.过滤集合</div><div>     &lt;!-- OGNL过滤集合的语法为：collection.{?expression} --&gt;</div><div>     &lt;s:property value=&quot;userlist.{?#this.age&gt;1}&quot;/&gt;  //获取到的是age&gt;1的对象集合</div><div>     2.投影集合</div><div>     &lt;s:property value=&quot;userlist.{^#this.age&gt;1}.{age}&quot;/&gt;  //获取到满足age&gt;1集合的第一个对象的age</div><div>     &lt;s:property value=&quot;userlist.{$#this.age&gt;1}.{age}&quot;/&gt;  //获取到满足age&gt;1集合的最后一个对象的age</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 